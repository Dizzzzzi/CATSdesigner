<ng-container *ngIf="subject">
  <app-popover-dialog class="subject-management">
    <ng-container title>
      {{ data.model && !data.model.subjectId ? ('subject.creation' | translate:'Создание предмета') : ('subject.editing' | translate:'Редактирование предмета') }}
    </ng-container>
    <ng-container body>
      <form class="example-form" #formElement="ngForm">
        <mat-form-field class="example-full-width">
          <mat-label>{{'subject.name' | translate:'Название предмета'}}</mat-label>
          <input
            required
            name="name"
            maxlength="256"
            matInput
            [subjectNameFree]="data.body"
            #name="ngModel"
            [subjectId]="subject.SubjectId"
            [(ngModel)]="subject.DisplayName"
          />
        </mat-form-field>
        <mat-error *ngIf="name.errors?.subjectNameFree && (formElement.touched || formElement.dirty)">
          Предмет с таким названием уже существует
        </mat-error>

        <mat-form-field class="example-full-width">
          <mat-label>{{'subject.abbreviation' | translate:'Аббревиатура'}}</mat-label>
          <input
            required
            maxlength="10"
            name="abbreviation"
            matInput
            #shortName="ngModel"
            [subjectAbbreviationFree]="data.body"
            [(ngModel)]="subject.ShortName"
            [subjectId]="subject.SubjectId"
          />
        </mat-form-field>
        <mat-error *ngIf="shortName.errors?.subjectAbbreviationFree && (formElement.touched || formElement.dirty)">
          Предмет с такой аббревиатурой уже существует
        </mat-error>
      </form>
  
      <h3 mat-dialog-title class="mat-typography title"></h3>
  
      <div class="section">
        <section class="example-section" [ngStyle]="{ 'grid-template-columns': 'repeat(' + columnsCount + ', auto)' }">
          <div *ngFor="let module of subject.Modules | toColumn:columnsCount">
            <mat-checkbox
            class="example-margin"
            *ngIf="module"
            [color]="'primary'"
            [disabled]="module.Required"
            [(ngModel)]="module.Checked"
          >
            {{ module.Name }}
          </mat-checkbox>
          </div>
  
        </section>
      </div>
  
      <div class="wrapper">
        <div>
          <h3 mat-dialog-title class="mat-typography title">{{'group.plural' | translate:'Группы'}}</h3>
          <mat-form-field class="example-full-width">
            <mat-label>{{'group.plural' | translate:'Группы'}}</mat-label>
            <mat-select [(value)]="selectedGroups" multiple>
              <mat-select-trigger>
                {{ selectedGroups.length ? getSelectedValue(selectedGroups[0]) : "" }}
                <span
                  *ngIf="selectedGroups?.length > 1"
                  class="example-additional-selection"
                >
                  (+{{ selectedGroups.length - 1 }} {{ selectedGroups.length | plural:('other' | translate:'другой' | lowercase):('others' | translate:'другие' | lowercase)}})
                </span>
              </mat-select-trigger>
              <mat-option *ngFor="let group of groupList" [value]="group.id">
                {{ group.value }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <h3 mat-dialog-title class="mat-typography title">{{'subject.color' | translate:'Цвет предмета'}}</h3>
          <input
            class="color-picker"
            [(colorPicker)]="subject.Color"
            [style.background]="subject.Color"
          />
        </div>
      </div>
    </ng-container>
    <ng-container actions>
      <button mat-raised-button (click)="onCancel()">{{'button.cancel' | translate:'Отмена'}}</button>
      <button
      mat-raised-button
      color="primary"
      (click)="save()"
      [disabled]="!formElement.valid"
    >
      {{'button.save' | translate:'Сохранить'}}
    </button>
    </ng-container>
  </app-popover-dialog>
</ng-container>